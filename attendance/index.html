---
title: FIRSTÂ® Alumni &amp; Mentors Network at Michigan
---
<!DOCTYPE html>
<html lang='en'>
<head>
    {% include title-styles.html %}
</head>
<body>
    {% include header.html %}
    
    <form class='w-50 mx-auto attendance-form'>
        <br>
        <div class="alert alert-success" role="alert" id="meetingSuccessAlert" style="display: none;">
            Meeting submitted successfully!
        </div>
        <div class="alert alert-danger" role="alert" id="meetingFailAlert" style="display: none;">
            Error submitting meeting. Please contact the webmaster for help.
        </div>
        <h1>FAMNM Attendance Form</h1>
        <p>
            <a href="view.html" class="btn famnm-btn-secondary">Click here for Attendance Viewer!</a>
        </p>
        <div class='form-group my-5'>
            <label for='meetingType'>Meeting Type</label>
            <select class='form-control' id='meetingType'>
                <option>
                    ------
                </option>
            </select>
        </div>
        <div class="my-5">
            <label for='meetingDate'>Date</label>
            <input type='date' id='meetingDate' />
        </div>
        
        <div class="my-5">
            <label for='uniqname'>Attendees</label>
            <br/>
            <input type='text' id='uniqname'>
            <button type='button' class='btn btn-primary' id='addUniqname'>+</button>
            <br/>
            <div id='uniqname-buttons'>
                
            </div>
        </div>
        
        <button type="button" class="btn famnm-btn my-3" data-toggle="modal" data-target="#confirmMeeting" id="confirm">Confirm</button>
    </form>
    
    <!-- Modal -->
    <div class="modal fade" id="confirmMeeting" tabindex="-1" role="dialog" aria-labelledby="confirmMeetingTitle" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmMeetingTitle">Confirm Submission</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div id="modalError" style="color:red"></div>

                    <h2>Meeting Details</h2>
                    <p id="modalMeetingType">Meeting Type: </p>
                    <p id="modalDate">Date: </p>

                    <h2>Meeting Attendees</h2>
                    <div id="modalAttendees"></div>
                </div>
                <div class="modal-footer d-flex">
                    <form class="mr-auto">
                        <input type='password' id='passphrase' placeholder='Passphrase'>
                        <small id="incorrectPassphrase" class="form-text text-muted" style="display: none;">Incorrect Passphrase</small>
                    </form>
                    <button type="button" class="btn famnm-btn submit-meeting" id="submit">Submit</button>
                </div>
            </div>
        </div>
    </div>
    
    {% include footer.html %}
    {% include scripts.html %}
    <script>
        let attendees = []

        const backend_url = 'https://famnm-website-backend.herokuapp.com/api/v2'

        const convertMeetingTime = (time) => {
            if(time.includes('AM') || time.includes('12')) {
                return time.slice(0, 5);
            } else {
                let hour = parseInt(time.slice(0, 3));
                return `${(hour + 12)}:${time.slice(2, 4)}`;
            }
        }
        
        const validateTime = (start, end) =>{
            return parseInt(start.replace(':', '')) < parseInt(end.replace(':', ''));
        } 

        const enterUniqname = () => {
            const uniqname = $('#uniqname').val().toLowerCase().replace(/[^a-zA-Z]/g, '');
            const uniqnameExists = attendees.some(elem => elem === uniqname);

            if (uniqname.length > 0 && !uniqnameExists) {
                attendees.push(uniqname);

                $('#uniqname-buttons').empty();
                attendees.forEach(elem => {
                    let newButton = $('<button></button>');
                    newButton.attr('type', 'button');
                    newButton.addClass('btn')
                            .addClass('btn-outline-secondary')
                            .addClass('mx-3')
                            .addClass('my-3')
                            .addClass('uniqname-btn');
                    newButton.text(elem);
                    newButton.click(() => {
                        attendees = attendees.filter(elem => elem !== newButton.text());
                        newButton.remove();
                    });

                    $('#uniqname-buttons').append(newButton);
                });
            }

            $('#uniqname').val('');
        }

        const currentLocalDate = () => {
            let t = new Date();
            
            return new Date(t - t.getTimezoneOffset() * 60 * 1000);
        }
            
        const disableSubmit = (message) => {
            $('#modalError').append($(`<p>${message}</p>`));
            $('.submit-meeting').attr('disabled', true);
            $('#passphrase').attr('disabled', true);
        }
            
        const resetModal = () => {
            $('#modalError').empty();
            $('#modalMeetingType').empty();
            $('#modalDate').empty();
            $('#modalAttendees').empty();
            $('#passphrase').val('');
            $('#passphrase').attr('disabled', false);
            $('#incorrectPassphrase').hide();
            $('.submit-meeting').attr('disabled', false);
        }
            
        const confirmMeeting = () => {
            resetModal();
            enterUniqname();

            const meetingType = $('#meetingType').children('option:selected').val();
            const meetingDate = $('#meetingDate').val();

            if (meetingType === '------') {
                disableSubmit('Meeting type not selected');
            }

            if (attendees.length === 0) {
                disableSubmit('No attendees');
            }

            $('#modalMeetingType').text(`Meeting Type: ${meetingType}`);
            $('#modalDate').text(`Date: ${meetingDate}`);

            fetch(backend_url + '/meeting/validate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    meeting_type: meetingType,
                    meeting_date: meetingDate,
                    attendees: attendees
                })
            }).then(response => {
                if (!response.ok) throw Error(response.statusText);
                return response.json();
            }).then(data => {
                if (data.already_exists) {
                    disableSubmit(`${meetingType} meeting already been recorded on ${meetingDate}`);
                }

                let uniqnameList = $('<ul></ul>');
                attendees.forEach(uniqname => {
                    let uniqnameItem = $('<li></li>');
                    uniqnameItem.text(uniqname);

                    if (data.new_uniqnames.includes(uniqname)) {
                        uniqnameItem.addClass('text-success');
                    }

                    uniqnameList.append(uniqnameItem);
                });

                $('#modalAttendees').append(uniqnameList);
            })
        }

        const submitMeeting = () => {
            const meetingType = $('#meetingType').children('option:selected').val();
            const meetingDate = $('#meetingDate').val();
            const passphrase = $('#passphrase').val();

            $('#passphrase').val('');

            fetch(backend_url + '/meeting', {
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Basic ${btoa(`famnm:${passphrase}`)}`
                },
                method: 'POST',
                body: JSON.stringify({
                    meeting_type: meetingType,
                    meeting_date: meetingDate,
                    attendees: attendees
                })
            }).then(response => {
                if (response.ok) {
                    attendees = [];

                    $('.attendance-form').trigger('reset');
                    $('#uniqname-buttons').empty();

                    $('#meetingSuccessAlert').show();
                    $('#meetingFailAlert').hide();

                    $('#confirmMeeting').modal('hide');
                    resetModal();
                } else if (response.status === 401) {
                    $('#incorrectPassphrase').show();
                } else {
                    throw Error(response.statusText);
                }
            }).catch(err => {
                console.log(err);

                $('#meetingSuccessAlert').hide();
                $('#meetingFailAlert').show();

                $('#confirmMeeting').modal('hide');
            });
        }
        
        $(() => {
            fetch(backend_url + '/meeting/types')
            .then(response => {
                if (!response.ok) throw Error(response.statusText);
                return response.json();
            }).then(data => {
                data.forEach(type => {
                    let meetingType = $('<option></option>');
                    meetingType.text(type);
                    $('#meetingType').append(meetingType);
                })
            })
            
            $('#meetingDate').attr('value', currentLocalDate().toISOString().slice(0, 10));
            
            $('#uniqname').keypress(e => {
                if (e.keyCode === 13) {
                    e.preventDefault();
                    enterUniqname();
                }
            });

            $('#addUniqname').click(enterUniqname);
            
            $('#confirm').click(confirmMeeting);
            
            $('#passphrase').keypress(e => {
                if (e.keyCode === 13) {
                    e.preventDefault();
                    submitMeeting();
                }
            });
            
            $('#submit').click(submitMeeting);
        });
    </script>
</body>
</html>
